FROM node:24-alpine
WORKDIR /app
COPY packages/gbif-org ./
RUN npm install

ARG PUBLIC_BASE_URL
ARG PUBLIC_WEB_UTILS
ARG PUBLIC_FORMS_ENDPOINT
ARG PUBLIC_CONTENT_SEARCH
ARG PUBLIC_GRAPHQL_ENDPOINT
ARG PUBLIC_GRAPHQL_ENDPOINT_SERVER
ARG PUBLIC_GRAPHQL_ENDPOINT_CLIENT
ARG PUBLIC_TRANSLATIONS_ENTRY_ENDPOINT
ARG PUBLIC_TRANSLATIONS_ENTRY_ENDPOINT_SERVER
ARG PUBLIC_TRANSLATIONS_ENTRY_ENDPOINT_CLIENT

ENV PUBLIC_BASE_URL=$PUBLIC_BASE_URL
ENV PUBLIC_WEB_UTILS=$PUBLIC_WEB_UTILS
ENV PUBLIC_FORMS_ENDPOINT=$PUBLIC_FORMS_ENDPOINT
ENV PUBLIC_CONTENT_SEARCH=$PUBLIC_CONTENT_SEARCH
ENV PUBLIC_TRANSLATIONS_ENTRY_ENDPOINT=$PUBLIC_TRANSLATIONS_ENTRY_ENDPOINT
ENV PUBLIC_TRANSLATIONS_ENTRY_ENDPOINT_SERVER=$PUBLIC_TRANSLATIONS_ENTRY_ENDPOINT_SERVER
ENV PUBLIC_TRANSLATIONS_ENTRY_ENDPOINT_CLIENT=$PUBLIC_TRANSLATIONS_ENTRY_ENDPOINT_CLIENT
ENV PUBLIC_GRAPHQL_ENDPOINT_SERVER=$PUBLIC_GRAPHQL_ENDPOINT_SERVER
ENV PUBLIC_GRAPHQL_ENDPOINT_CLIENT=$PUBLIC_GRAPHQL_ENDPOINT_CLIENT
ENV PUBLIC_GRAPHQL_ENDPOINT=$PUBLIC_GRAPHQL_ENDPOINT

RUN npm run build

ENV NODE_ENV=production
CMD ["node", "gbif/server.js"]
EXPOSE 6813